/*! 作者:阿伟 */
/*! git:https://github.com/328080339/JsLibs.git */
/*! 推荐sealoader模块加载器:https://www.npmjs.com/package/sealoader */
/*! 最后修改于 2016-04-05 13:39:40 */
define(function(require,a,b){var c=b.uri;c=c.substring(0,c.lastIndexOf("/js/"))+"/";var d=require("seajs-utils"),e=require("seajs-jquery"),f=function(a){var b=a.mySuperWrapper;return b||(b=document.createElement("mySuperWrapper"),a.mySuperWrapper=b,b.style.cssText="position:relative;float:left;"),a.insertBefore(b,a.firstChild),b},g=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();return{left:c.left-d.left,top:c.top-d.top}};a.bind=function(a,b){d.use([[c+"css/calendar.css","calendar"]],function(){a.tagName&&(a=[a]);for(var c=0,d=a.length;d>c;c++){var h=a[c],i=f(h.parentNode),j=document.createElement("calendarNode");j.style.cssText="position:absolute;",i.appendChild(j);var k=window.getComputedStyle(h),l=function(a,b){var c=b.parentNode.mySuperWrapper,d=g(b,b.parentNode),e={l:d.left,t:d.top};return"fixed"==a.position?e:(d=g(c,c.parentNode),{l:e.l-d.left,t:e.t-d.top})},m=l(k,h);b=b||{},b.trigger=e(h);var n=b.onSelected;b.onSelected=function(a,b,c){h.onIpt&&h.onIpt(),n&&n.apply(null,arguments)},b.date=new Date(b.date||(b.selectedRang&&2==b.selectedRang.length?b.selectedRang[1]:new Date)),e(j).calendar(b),j.style.cssText+=";left:"+m.l+"px;top:"+(m.t+h.getBoundingClientRect().height)+"px;"}b.canEditYear!==!1&&e(".calendar-display").on("click",function(a){var c=a.srcElement||a.target,d=c.getElementsByTagName("span");if(d.length>0){a.stopPropagation();var g=c.yearIpt;if(g)g.style.display="block";else{var h=c.parentNode.parentNode.parentNode.parentNode.parentNode,i=f(c.parentNode),g=document.createElement("input");g.className="calendar-display",g.maxLength=4,g.style.cssText="position:absolute;outline:none;border:0;width:"+(c.getBoundingClientRect().width-d[0].getBoundingClientRect().width-13)+"px;",g.addEventListener("blur",function(){var a=new Date;a.setFullYear(this.value);var c=a.getTime();isNaN(c)||b.selectedRang&&!(c>=new Date(b.selectedRang[0]).getTime()&&c<=new Date(b.selectedRang[1]).getTime())||e(h).data("calendar").updateMonthView(this.value),g.style.display="none"}),i.appendChild(g),c.yearIpt=g}g.value=c.innerHTML.split("/")[0],setTimeout(function(){g.focus()},0)}})})}});